# Computing Zoom Videos

In this tutorial, you'll learn how to create Mandelbrot zoom videos using the DeepDrill tool chain. In particular, we are going to compute the following  video which is available on Youtube:

<iframe width="560" height="315" src="https://www.youtube.com/embed/Ayc5bE9nmTA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

Unlike calculating still images, creating a zoom video requires a much more sophisticated workflow. For example, multiple keyframes must be calculated and stitched together in the right way. To simplify the process, video creation has been divided into three phases. In the first phase, `deepmake` is used to create a Makefile and a larger number of input files. In the second phase, the Makefile is executed to compute all keyframe images via seperate invocations to `deepdrill`. In the last phase, `deepzoom` is executed to assemble the final video by calculating intermediate frames.

## Setting Up the Workflow

Out first task is to create an empty project directory:
```bash
mkdir project
```
To set up a workflow in this directory, we launch `deepmake` with the following options:
```bash
./deepmake -p spider.prf -o project spider.loc
```
```
DeepMake 2.0b1 - (C)opyright Dirk W. Hoffmann

       Generating project file: ................................. 0.00 sec
  Generating 75 location files: ................................. 0.00 sec
            Generating profile: ................................. 0.00 sec
           Generating Makefile: ................................. 0.00 sec

Total time: 0.01 sec
```
If no profile had been specified, DeepDrill would have set up the workflow to zoom to the location specified in `spider.loc` with predefined settings. In our example, this would result in a fairly long video. To customize settings, we instructed DeepDrill to read in `spider.prf` before setting up the workflow. This profile defines the following keys:
```
[video]
keyframes = 75
inbetweens = 143
bitrate = 8000
```
The first key specifies the number of keyframes to calculate, and the second key specifies how many frames to insert between two consecutive keyframes. If the video was recorded at 60 Hz, a value of 60 results in a delay of one second between two keyframes. In our case, a value of 143 is given. This means that it takes a little more than 2 seconds to get from one keyframe to the next. The result is a video with a total length of about 3 minutes. 

Let's take a closer look at the files DeepDrill created in the project directory:  
- `spider.prj`
  This file contains several key-value pairs which will be picked up later by `deepflight` to assemble the final video.

- `spider.prf`
  This profile is used for calculating keyframes. It is composed out of the profiles that were passed in as command line arguments when the workflow was set up.

- `spider_0.loc` to `spider_75.loc`
  These position files contain the coordinates and zoom factors for each keyframe.

- `Makefile`
  This is a standard Makefile that automatically calculates all keyframe images. In the next section we will take a closer look at its contents.

## Computing all keyframes

For our tutorial project, DeepDrill has created the following Makefile:

```Make
# Generated by DeepDrill 2.0b1 on Fri Jun  9 06:57:53 2023
# 
# Copyright (C) Dirk W. Hoffmann. www.dirkwhoffmann.de
# Licensed under the GNU General Public License v3

DEEPDRILL  = /Users/hoff/tmp/dd/./deepdrill
DEEPZOOM   = /Users/hoff/tmp/dd/./deepzoom
MAPS       = $(patsubst %.loc,%.map,$(wildcard *_*.loc))
VIDEO      = spider.mov
MAPFLAGS   = -b

.PHONY: all maps clean

all: maps

maps: $(MAPS)

%.map: %.loc
  @$(DEEPDRILL) $(MAPFLAGS) -p spider.prf -o $*.map -o $*.jpg $*.loc > $*.log

$(VIDEO): $(IMAGES)
  @$(DEEPZOOM) $(MOVFLAGS) spider.prj -o $(VIDEO)

clean:
  rm *.mov *.map *.png *.log
```
The Makefile defines two major goals: One is to create the map files from the location files and the other one is to compose the final video. To create all map files, we change to the project directory and run the Make utility:
```bash
cd project
make -j4
```
The `-j` option instructs Make to run multiple jobs in parallel, four jobs in this case. Although this option is not mandatory, its use is strongly recommended as it significantly reduces the overall computation time.

Depending on the performance of your machine, it may take a while to calculate all images. After successful completion, the project directory contains a map file and an image file for each keyframe. 

## Assembling the Zoom Video

The final step is to combine all the keyframes into a zoom video by calling `make` with the `spider.mov` target as argument:
```bash
make spider.mov 
```
This target executes a separate tool called `deepzoom` which stiches together all previously computed keyframes. After completion, file `spider.mov` will be created, which contains the final video. 
